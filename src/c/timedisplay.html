<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<title></title>
<style type="text/css">
body {padding-top: 20px;padding-bottom: 20px;}
.header,.marketing,.footer {padding-right: 15px;padding-left: 15px;}
.header {padding-bottom: 20px;border-bottom: 1px solid #e5e5e5;}
.header h3 {margin-top: 0;margin-bottom: 0;line-height: 40px;}
.footer {padding-top: 19px;color: #777;border-top: 1px solid #e5e5e5;}
@media (min-width: 1024px) {.container {max-width: 1000px;}}
.container-narrow > hr {margin: 30px 0;}
.jumbotron {border-bottom: 1px solid #e5e5e5;}
.jumbotron .btn {padding: 14px 24px;font-size: 21px;}
.marketing {margin: 40px 0;}
.marketing p + h4 {margin-top: 28px;}
@media screen and (min-width: 1024px) {
.header,.marketing,.footer {padding-right: 0;padding-left: 0;}
.header {margin-bottom: 30px;}
.jumbotron {border-bottom: 0;}
}
img {max-width: 100%}
</style>
</head>
<body>
<div class="container">
<div class="panel panel-default">
  <div class="panel-heading">Table of Contents</div>
  <div class="panel-body">
    <ul>
    <li><a href="#include-pebble.h">include &lt;pebble.h&gt;</a></li>
    <li><a href="#include-timedisplay.h">include &quot;timedisplay.h&quot;</a></li>
    <li><a href="#include-health.h">include &quot;health.h&quot;</a></li>
    <li><a href="#include-constants.h">include &quot;constants.h&quot;</a></li>
    </ul>
  </div>
</div>
<h1 id="include-pebble.h">include &lt;pebble.h&gt;</h1>
<h1 id="include-timedisplay.h">include &quot;timedisplay.h&quot;</h1>
<h1 id="include-health.h">include &quot;health.h&quot;</h1>
<h1 id="include-constants.h">include &quot;constants.h&quot;</h1>
<p>static void tick_handler(struct tm *tick_time, TimeUnits units_changed);</p>
<p>static void time_update_proc(Layer <em>layer, GContext </em>ctx); static void add_text_layer(Layer <em>window_layer, TextLayer </em>text_layer, GTextAlignment alignment);</p>
<p>static TextLayer <em>s_time_hour_text_layer, </em>s_time_minute_text_layer, *s_date_text_layer;</p>
<p>static int s_hour_level, s_minute_level;</p>
<p>static Layer *s_time_layer;</p>
<p>static GFont s_time_font;</p>
<p>void timedisplay_load_graphics(Window <em>window) { Layer </em>window_layer = window_get_root_layer(window); GRect bounds = layer_get_bounds(window_layer);</p>
<p>int hh = bounds.size.h&gt;&gt;1; int hw = bounds.size.w&gt;&gt;1;</p>
<p>// Create hour meter Layer s_time_layer = layer_create(GRect(0, 0, bounds.size.w, bounds.size.h)); layer_set_update_proc(s_time_layer, time_update_proc); layer_add_child(window_layer, s_time_layer); } void timedisplay_load_text(Window <em>window) { Layer </em>window_layer = window_get_root_layer(window); GRect bounds = layer_get_bounds(window_layer);</p>
<p>int hh = bounds.size.h&gt;&gt;1; int hw = bounds.size.w&gt;&gt;1;</p>
<p>s_time_font = fonts_load_custom_font(resource_get_handle(RESOURCE_ID_PIXELS_49));</p>
<p>// Create the time display // I can't seem to calculate 52 from the other values, I will find a way (or at least in a way that makes sense) // text_layer_set_font(s_time_text_layer, fonts_get_system_font(FONT_KEY_ROBOTO_BOLD_SUBSET_49)); // s_time_hour_text_layer = text_layer_create(GRect(0, hh&gt;&gt;1, bounds.size.w, TITLE_TEXT_HEIGHT)); text_layer_set_font(s_time_hour_text_layer, s_time_font); add_text_layer(window_layer, s_time_hour_text_layer, GTextAlignmentCenter); // s_time_minute_text_layer = text_layer_create(GRect(0, hh, bounds.size.w, TITLE_TEXT_HEIGHT)); text_layer_set_font(s_time_minute_text_layer, s_time_font); add_text_layer(window_layer, s_time_minute_text_layer, GTextAlignmentCenter);</p>
<p>// Create the date display s_date_text_layer = text_layer_create(GRect(0, -5, bounds.size.w, SUB_TEXT_HEIGHT)); text_layer_set_font(s_date_text_layer, fonts_get_system_font(FONT_KEY_GOTHIC_24_BOLD)); add_text_layer(window_layer, s_date_text_layer, GTextAlignmentLeft); } void timedisplay_unload(Window *window) {</p>
<p>text_layer_destroy(s_time_hour_text_layer); text_layer_destroy(s_time_minute_text_layer); text_layer_destroy(s_date_text_layer); layer_destroy(s_time_layer); fonts_unload_custom_font(s_time_font); }</p>
<p>void timedisplay_init() { update_time(); tick_timer_service_subscribe(MINUTE_UNIT, tick_handler); } void timedisplay_deinit() {</p>
<p>}</p>
<p>static void add_text_layer(Layer <em>window_layer, TextLayer </em>text_layer, GTextAlignment alignment) { text_layer_set_background_color(text_layer, GColorClear); text_layer_set_text_color(text_layer, GColorBlack); text_layer_set_text_alignment(text_layer, alignment); layer_add_child(window_layer, text_layer_get_layer(text_layer)); }</p>
<p>/** * On every tick run this function <em> </em> <span class="citation">@param</span> tick_time The orriginal time * <span class="citation">@param</span> units_changed What units changed <em>/ static void tick_handler(struct tm </em>tick_time, TimeUnits units_changed) { update_time(); update_health(); }</p>
<p>/** * When the hour layer is marked as dirty run thi <em> </em> <span class="citation">@param</span> layer The layer to update * <span class="citation">@param</span> ctx The context <em>/ static void time_update_proc(Layer </em>layer, GContext *ctx) { GRect bounds = layer_get_bounds(layer);</p>
<p>graphics_context_set_fill_color(ctx, GColorPictonBlue); graphics_fill_radial(ctx, GRect(0, 0, bounds.size.w, bounds.size.h), GOvalScaleModeFitCircle, PIE_THICKNESS, 0, s_hour_level * DEG_TO_TRIGANGLE(15));</p>
<p>graphics_context_set_fill_color(ctx, GColorMagenta); graphics_fill_radial(ctx, GRect(bounds.size.w &gt;&gt; 3, bounds.size.h &gt;&gt; 3, (3 * bounds.size.w) &gt;&gt; 2, (3 * bounds.size.h) &gt;&gt; 2), GOvalScaleModeFitCircle, PIE_THICKNESS, 0, s_minute_level * DEG_TO_TRIGANGLE(6)); }</p>
<p>/** * When the time is updated run this to update the various components */ void update_time() { static char s_hour_buffer[8]; static char s_minute_buffer[8]; static char date_buffer[16];</p>
<p>// Get the current time time_t temp = time(NULL); struct tm *tick_time = localtime(&amp;temp);</p>
<p>// Save the minute and hour (for the bars) s_hour_level = tick_time-&gt;tm_hour; s_minute_level = tick_time-&gt;tm_min;</p>
<p>// Create the string for the time display strftime(s_hour_buffer, sizeof(s_hour_buffer), clock_is_24h_style() ?&quot;%H&quot; : &quot;%I&quot;, tick_time); text_layer_set_text(s_time_hour_text_layer, s_hour_buffer); strftime(s_minute_buffer, sizeof(s_minute_buffer), &quot;%M&quot;, tick_time); text_layer_set_text(s_time_minute_text_layer, s_minute_buffer);</p>
<p>// Create the string for the date display strftime(date_buffer, sizeof(date_buffer), &quot;%a %d %b&quot;, tick_time); text_layer_set_text(s_date_text_layer, date_buffer);</p>
<p>// Mark the layers as dirty layer_mark_dirty(s_time_layer); }</p>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
</body>
</html>
